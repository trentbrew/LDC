{
  "@context": { "ex": "https://example.com/" },
  "@id": "ex:dashboard",

  "@relations": {
    "projects": "./projects.data",
    "team": "./team.data"
  },

  "totalBudget": { "@rollup": "projects.items.budget:sum" },
  "projectCount": { "@rollup": "projects.items:count" },
  "avgBudget": { "@rollup": "projects.items.budget:avg" },
  "totalHours": { "@rollup": "projects.items.hours:sum" },

  "activeBudget": {
    "@rollup": {
      "relation": "projects",
      "property": "items",
      "filter": "status == 'active'",
      "select": "budget",
      "aggregate": "sum"
    }
  },

  "activeProjects": {
    "@rollup": {
      "relation": "projects",
      "property": "items",
      "filter": "status == 'active'",
      "aggregate": "count"
    }
  },

  "teamSize": { "@rollup": "team.members:count" },
  "avgRate": { "@rollup": "team.members.rate:avg" },
  "teamNames": { "@rollup": "team.members.name:concat" },
  "developerCount": {
    "@rollup": {
      "relation": "team",
      "property": "members",
      "filter": "role == 'developer'",
      "aggregate": "count"
    }
  },

  "devOrDesignerCount": {
    "@rollup": {
      "relation": "team",
      "property": "members",
      "filter": "role == 'developer' || role == 'designer'",
      "aggregate": "count"
    }
  },

  "highBudgetActive": {
    "@rollup": {
      "relation": "projects",
      "property": "items",
      "filter": "status == 'active' && budget >= 5000",
      "select": "name",
      "aggregate": "concat"
    }
  },

  "estimatedLaborCost": { "@expr": "totalHours * avgRate" },
  "profitMargin": { "@expr": "totalBudget - estimatedLaborCost" },
  "activeMargin": { "@expr": "activeBudget - estimatedLaborCost" },

  "totalBudgetFormatted": { "@expr": "$currency(totalBudget)" },
  "laborCostFormatted": { "@expr": "$currency(estimatedLaborCost)" },
  "profitMarginFormatted": { "@expr": "$currency(profitMargin)" },
  "avgRateFormatted": { "@expr": "$currency(avgRate) + '/hr'" },

  "metrics": {
    "@expr": "{ projects: projectCount, active: activeProjects, budget: $currency(totalBudget), team: teamSize }"
  },

  "summary": {
    "@expr": "projectCount + ' projects (' + activeProjects + ' active), ' + $currency(totalBudget) + ' budget, ' + teamSize + ' team members'"
  },

  "healthStatus": {
    "@expr": "profitMargin > 0 ? 'profitable' : 'at-risk'"
  }
}
